<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TRAP TOWN - Store</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@700&family=Inter:wght@400;600;700&display=swap');

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background-color: #0a0a0a;
      background-image: url('bg.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
      color: #e0e0e0;
      font-family: 'Inter', sans-serif;
      min-height: 100vh;
    }

    /* ── Top Banner ── */
    .top-banner {
      width: 100%;
      text-align: center;
      padding: 32px 16px 24px;
      border-bottom: 2px solid #ff0a0a;
      background: linear-gradient(180deg, rgba(26,13,13,0.85) 0%, rgba(10,10,10,0.85) 100%);
    }

    .top-banner h1 {
      font-family: 'Rajdhani', sans-serif;
      font-size: 64px;
      color: #ff0a0a;
      letter-spacing: 12px;
      text-shadow: 0 0 20px rgba(255, 10, 10, 0.4), 0 0 60px rgba(255, 10, 10, 0.15);
    }

    .top-banner p {
      margin-top: 8px;
      font-size: 14px;
      color: #5a5a5a;
      letter-spacing: 4px;
      text-transform: uppercase;
    }

    /* ── Nav ── */
    nav {
      display: flex;
      justify-content: center;
      gap: 32px;
      padding: 16px;
      border-bottom: 1px solid #3d1a1a;
      background: rgba(10, 10, 10, 0.8);
    }

    nav a {
      color: #df6f6f;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      letter-spacing: 2px;
      text-transform: uppercase;
      padding: 8px 16px;
      border: 1px solid transparent;
      border-radius: 6px;
      transition: all 0.3s;
    }

    nav a:hover {
      border-color: #ff0a0a;
      background: rgba(255, 10, 10, 0.05);
      color: #ff0a0a;
    }

    /* ── Main ── */
    main {
      max-width: 1200px;
      margin: 0 auto;
      padding: 48px 24px;
    }

    .section-title {
      font-family: 'Rajdhani', sans-serif;
      font-size: 32px;
      color: #ff0a0a;
      text-align: center;
      margin-bottom: 8px;
      letter-spacing: 4px;
    }

    .section-subtitle {
      text-align: center;
      color: #5a5a5a;
      font-size: 14px;
      margin-bottom: 40px;
    }

    /* ── Gamepass Grid ── */
    .gamepass-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
      gap: 24px;
    }

    .gamepass-card {
      border: 1px solid #3d1a1a;
      border-radius: 12px;
      padding: 28px 24px;
      background: #0f0f0f;
      transition: all 0.3s;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .gamepass-card:hover {
      border-color: #ff0a0a;
      box-shadow: 0 0 24px rgba(255, 10, 10, 0.08);
      transform: translateY(-4px);
    }

    .gamepass-icon {
      width: 80px;
      height: 80px;
      border-radius: 12px;
      border: 2px solid #3d1a1a;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 36px;
      margin-bottom: 20px;
      background: #111;
    }

    .gamepass-card:hover .gamepass-icon {
      border-color: #ff0a0a;
    }

    .gamepass-name {
      font-family: 'Rajdhani', sans-serif;
      font-size: 22px;
      color: #ffffff;
      margin-bottom: 8px;
      letter-spacing: 1px;
    }

    .gamepass-desc {
      font-size: 13px;
      color: #777;
      margin-bottom: 20px;
      line-height: 1.5;
      flex-grow: 1;
    }

    .gamepass-price {
      font-family: 'Rajdhani', sans-serif;
      font-size: 20px;
      color: #ff0a0a;
      margin-bottom: 16px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .robux-icon {
      width: 18px;
      height: 18px;
      display: inline-block;
      background: #ff0a0a;
      border-radius: 50%;
      position: relative;
    }

    .buy-btn {
      display: inline-block;
      padding: 12px 36px;
      background: transparent;
      border: 2px solid #ff0a0a;
      color: #ff0a0a;
      font-family: 'Rajdhani', sans-serif;
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 3px;
      text-transform: uppercase;
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s;
      cursor: pointer;
    }

    .buy-btn:hover {
      background: #ff0a0a;
      color: #0a0a0a;
      box-shadow: 0 0 20px rgba(255, 10, 10, 0.3);
    }

    /* ── Featured / Popular Badge ── */
    .badge {
      display: inline-block;
      padding: 4px 12px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      border-radius: 20px;
      margin-bottom: 16px;
    }

    .badge-popular {
      background: rgba(255, 10, 10, 0.1);
      color: #ff0a0a;
      border: 1px solid #ff0a0a;
    }

    .badge-new {
      background: rgba(255, 100, 100, 0.1);
      color: #ff6464;
      border: 1px solid #ff6464;
    }

    /* ── Turfs Section ── */
    .turfs-section {
      max-width: 1200px;
      margin: 0 auto;
      padding: 48px 24px;
    }

    .turfs-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 24px;
      margin-top: 32px;
    }

    .turf-card {
      background: rgba(15, 10, 10, 0.9);
      border: 1px solid #3d1a1a;
      border-radius: 16px;
      padding: 32px 24px;
      text-align: center;
      transition: all 0.3s;
      position: relative;
      overflow: hidden;
    }

    .turf-card:hover {
      border-color: #ff0a0a;
      transform: translateY(-4px);
      box-shadow: 0 0 20px rgba(255, 10, 10, 0.1);
    }

    .turf-card.featured {
      border-color: #ff0a0a;
      box-shadow: 0 0 30px rgba(255, 10, 10, 0.15);
    }

    .turf-card.featured::before {
      content: 'BEST VALUE';
      position: absolute;
      top: 12px;
      right: -28px;
      background: #ff0a0a;
      color: #000;
      font-size: 10px;
      font-weight: 700;
      padding: 4px 32px;
      transform: rotate(45deg);
      letter-spacing: 1px;
    }

    .turf-size {
      font-family: 'Rajdhani', sans-serif;
      font-size: 24px;
      color: #ff0a0a;
      font-weight: 700;
      letter-spacing: 2px;
      margin-bottom: 8px;
    }

    .turf-desc {
      color: #7a7a7a;
      font-size: 14px;
      margin-bottom: 20px;
      line-height: 1.5;
    }

    .turf-price {
      font-family: 'Rajdhani', sans-serif;
      font-size: 42px;
      color: #fff;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .turf-price span {
      font-size: 18px;
      color: #5a5a5a;
    }

    .turf-features {
      text-align: left;
      margin: 20px 0;
      padding: 0;
      list-style: none;
    }

    .turf-features li {
      color: #b0b0b0;
      font-size: 13px;
      padding: 6px 0;
      border-bottom: 1px solid rgba(255,255,255,0.05);
    }

    .turf-features li::before {
      content: '\2713';
      color: #ff0a0a;
      margin-right: 8px;
      font-weight: 700;
    }

    .turf-buy-btn {
      display: inline-block;
      width: 100%;
      padding: 14px 0;
      background: linear-gradient(135deg, #ff0a0a, #cc0a0a);
      color: #000;
      font-family: 'Rajdhani', sans-serif;
      font-size: 16px;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 2px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s;
      margin-top: 12px;
    }

    .turf-buy-btn:hover {
      background: linear-gradient(135deg, #ff3333, #ff0a0a);
      box-shadow: 0 0 20px rgba(255, 10, 10, 0.3);
    }

    /* ── Leaderboard ── */
    .leaderboard-section {
      max-width: 700px;
      margin: 0 auto;
      padding: 48px 24px;
    }

    .leaderboard-table {
      width: 100%;
      margin-top: 32px;
      border-collapse: separate;
      border-spacing: 0 8px;
    }

    .leaderboard-row {
      background: rgba(15, 10, 10, 0.9);
      border: 1px solid #3d1a1a;
      transition: all 0.3s;
    }

    .leaderboard-row:hover {
      border-color: #ff0a0a;
      box-shadow: 0 0 15px rgba(255, 10, 10, 0.1);
    }

    .leaderboard-row td {
      padding: 12px 16px;
      vertical-align: middle;
    }

    .leaderboard-row td:first-child {
      border-radius: 12px 0 0 12px;
      width: 50px;
      text-align: center;
    }

    .leaderboard-row td:last-child {
      border-radius: 0 12px 12px 0;
    }

    .lb-rank {
      font-family: 'Rajdhani', sans-serif;
      font-size: 22px;
      font-weight: 700;
      color: #5a5a5a;
    }

    .lb-rank-1 { color: #ffd700; }
    .lb-rank-2 { color: #c0c0c0; }
    .lb-rank-3 { color: #cd7f32; }

    .lb-user {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .lb-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      border: 2px solid #3d1a1a;
    }

    .lb-name {
      font-weight: 600;
      color: #e0e0e0;
      font-size: 15px;
    }

    .lb-username {
      color: #5a5a5a;
      font-size: 12px;
    }

    .lb-visits {
      text-align: right;
      font-family: 'Rajdhani', sans-serif;
      font-size: 20px;
      font-weight: 700;
      color: #ff0a0a;
    }

    .lb-visits span {
      font-size: 11px;
      color: #5a5a5a;
      font-family: 'Inter', sans-serif;
      font-weight: 400;
    }

    .lb-empty {
      text-align: center;
      color: #5a5a5a;
      padding: 32px;
    }

    /* ── Footer ── */
    footer {
      text-align: center;
      padding: 32px 16px;
      border-top: 1px solid #3d1a1a;
      margin-top: 64px;
      color: #3a3a3a;
      font-size: 13px;
      background: rgba(10, 10, 10, 0.85);
    }

    footer a {
      color: #ff0a0a;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    /* ── Responsive ── */
    @media (max-width: 600px) {
      .top-banner h1 {
        font-size: 36px;
        letter-spacing: 6px;
      }

      nav {
        flex-wrap: wrap;
        gap: 12px;
      }

      .gamepass-grid {
        grid-template-columns: 1fr;
      }
    }
    /* ── Discord Login Overlay ── */
    .discord-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #0a0a0a;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .discord-overlay.hidden {
      display: none;
    }

    .discord-box {
      background: #111;
      border: 1px solid #3d1a1a;
      border-radius: 16px;
      padding: 48px 40px;
      text-align: center;
      max-width: 420px;
      width: 90%;
    }

    .discord-box h2 {
      font-family: 'Rajdhani', sans-serif;
      font-size: 36px;
      color: #ff0a0a;
      letter-spacing: 6px;
      margin-bottom: 8px;
      text-shadow: 0 0 20px rgba(255, 10, 10, 0.3);
    }

    .discord-box p {
      color: #777;
      font-size: 14px;
      margin-bottom: 32px;
      line-height: 1.6;
    }

    .discord-btn {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      padding: 14px 32px;
      background: #5865F2;
      color: #fff;
      font-family: 'Inter', sans-serif;
      font-size: 16px;
      font-weight: 700;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      text-decoration: none;
      transition: all 0.3s;
    }

    .discord-btn:hover {
      background: #4752c4;
      box-shadow: 0 0 20px rgba(88, 101, 242, 0.4);
      transform: translateY(-2px);
    }

    .discord-btn svg {
      width: 24px;
      height: 24px;
      fill: #fff;
    }

    .discord-divider {
      width: 60px;
      height: 2px;
      background: #3d1a1a;
      margin: 24px auto;
    }

    .discord-box .note {
      color: #3a3a3a;
      font-size: 11px;
      margin-top: 24px;
    }

    /* ── Logged-in user bar ── */
    .user-bar {
      display: flex;
      align-items: center;
      justify-content: flex-end;
      padding: 8px 20px;
      background: #0d0d0d;
      border-bottom: 1px solid #3d1a1a;
      gap: 10px;
    }

    .user-bar img {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 2px solid #ff0a0a;
    }

    .user-bar span {
      color: #df6f6f;
      font-size: 13px;
      font-weight: 600;
    }

    .logout-btn {
      color: #555;
      font-size: 12px;
      background: none;
      border: 1px solid #333;
      padding: 4px 12px;
      border-radius: 4px;
      cursor: pointer;
      margin-left: 8px;
      transition: all 0.3s;
    }

    .logout-btn:hover {
      border-color: #ff3333;
      color: #ff3333;
    }

    /* ── Dashboard ── */
    .dashboard-section {
      max-width: 700px;
      margin: 0 auto;
      padding: 48px 24px;
    }

    .lookup-box {
      background: #0f0f0f;
      border: 1px solid #3d1a1a;
      border-radius: 12px;
      padding: 40px 32px;
      text-align: center;
      margin-bottom: 32px;
    }

    .lookup-icon {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .lookup-title {
      font-family: 'Rajdhani', sans-serif;
      font-size: 24px;
      color: #fff;
      margin-bottom: 8px;
      letter-spacing: 2px;
    }

    .lookup-desc {
      color: #777;
      font-size: 13px;
      margin-bottom: 24px;
    }

    .lookup-input-wrap {
      display: flex;
      gap: 8px;
      max-width: 400px;
      margin: 0 auto;
    }

    .lookup-input {
      flex: 1;
      padding: 12px 16px;
      background: #111;
      border: 1px solid #3d1a1a;
      border-radius: 8px;
      color: #e0e0e0;
      font-family: 'Inter', sans-serif;
      font-size: 14px;
      outline: none;
      transition: border-color 0.3s;
    }

    .lookup-input:focus {
      border-color: #ff0a0a;
    }

    .lookup-btn {
      padding: 12px 24px;
      background: #ff0a0a;
      color: #0a0a0a;
      font-family: 'Rajdhani', sans-serif;
      font-size: 16px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .lookup-btn:hover {
      box-shadow: 0 0 20px rgba(255, 10, 10, 0.3);
    }

    .lookup-btn:disabled {
      background: #333;
      color: #666;
      cursor: not-allowed;
      box-shadow: none;
    }

    .lookup-error {
      color: #ff3333;
      font-size: 13px;
      margin-top: 12px;
    }

    /* ── Profile Card ── */
    .profile-card {
      background: #0f0f0f;
      border: 1px solid #ff0a0a;
      border-radius: 12px;
      padding: 20px 24px;
      display: flex;
      align-items: center;
      gap: 16px;
      margin-bottom: 32px;
    }

    .profile-avatar {
      width: 56px;
      height: 56px;
      border-radius: 50%;
      border: 2px solid #ff0a0a;
    }

    .profile-info {
      flex: 1;
    }

    .profile-name {
      font-family: 'Rajdhani', sans-serif;
      font-size: 22px;
      color: #fff;
      letter-spacing: 1px;
    }

    .profile-username {
      color: #5a5a5a;
      font-size: 13px;
    }

    .unlink-btn {
      color: #555;
      font-size: 12px;
      background: none;
      border: 1px solid #333;
      padding: 6px 16px;
      border-radius: 6px;
      cursor: pointer;
      transition: all 0.3s;
    }

    .unlink-btn:hover {
      border-color: #ff3333;
      color: #ff3333;
    }

    /* ── Owned Passes ── */
    .owned-title {
      font-family: 'Rajdhani', sans-serif;
      font-size: 20px;
      color: #ff0a0a;
      letter-spacing: 3px;
      text-align: center;
      margin-bottom: 20px;
    }

    .owned-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 12px;
    }

    .owned-item {
      background: #0f0f0f;
      border: 1px solid #3d1a1a;
      border-radius: 10px;
      padding: 16px 20px;
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .owned-item.owned {
      border-color: #ff0a0a;
    }

    .owned-item.not-owned {
      opacity: 0.4;
    }

    .owned-item-icon {
      font-size: 28px;
      width: 48px;
      height: 48px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: #111;
      border-radius: 8px;
      border: 1px solid #3d1a1a;
    }

    .owned-item.owned .owned-item-icon {
      border-color: #ff0a0a;
    }

    .owned-item-info {
      flex: 1;
    }

    .owned-item-name {
      font-family: 'Rajdhani', sans-serif;
      font-size: 18px;
      color: #fff;
      letter-spacing: 1px;
    }

    .owned-item-status {
      font-size: 12px;
      margin-top: 2px;
    }

    .status-owned {
      color: #ff0a0a;
    }

    .status-not-owned {
      color: #555;
    }

    .no-passes {
      text-align: center;
      color: #555;
      font-size: 14px;
      padding: 24px;
    }

    /* ── Team Section ── */
    .team-section {
      max-width: 700px;
      margin: 0 auto;
      padding: 48px 24px;
    }

    .team-grid {
      display: flex;
      justify-content: center;
      gap: 32px;
      flex-wrap: wrap;
      margin-top: 8px;
    }

    .team-card {
      background: #0f0f0f;
      border: 1px solid #3d1a1a;
      border-radius: 16px;
      padding: 32px 40px;
      text-align: center;
      min-width: 220px;
      transition: all 0.3s;
    }

    .team-card:hover {
      border-color: #ff0a0a;
      box-shadow: 0 0 24px rgba(255, 10, 10, 0.08);
      transform: translateY(-4px);
    }

    .team-avatar-wrap {
      width: 96px;
      height: 96px;
      margin: 0 auto 16px;
      position: relative;
    }

    .team-avatar-wrap img {
      width: 96px;
      height: 96px;
      border-radius: 50%;
      border: 3px solid #ff0a0a;
      object-fit: cover;
    }

    .team-avatar-placeholder {
      width: 96px;
      height: 96px;
      border-radius: 50%;
      border: 3px solid #3d1a1a;
      background: #111;
    }

    .team-status {
      width: 18px;
      height: 18px;
      border-radius: 50%;
      border: 3px solid #0f0f0f;
      position: absolute;
      bottom: 2px;
      right: 2px;
    }

    .team-status.online { background: #a52323; }
    .team-status.idle { background: #f0b232; }
    .team-status.dnd { background: #f23f43; }
    .team-status.offline { background: #80848e; }

    .team-name {
      font-family: 'Rajdhani', sans-serif;
      font-size: 22px;
      color: #fff;
      letter-spacing: 1px;
      margin-bottom: 4px;
    }

    .team-username {
      color: #5a5a5a;
      font-size: 13px;
      margin-bottom: 12px;
    }

    .team-tag {
      display: inline-block;
      padding: 4px 14px;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 2px;
      text-transform: uppercase;
      border-radius: 20px;
      background: rgba(255, 10, 10, 0.1);
      color: #ff0a0a;
      border: 1px solid #ff0a0a;
    }

    /* ── Music Player ── */
    .music-btn {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: #111;
      border: 2px solid #3d1a1a;
      color: #ff0a0a;
      font-size: 20px;
      cursor: pointer;
      z-index: 9998;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s;
    }

    .music-btn:hover {
      border-color: #ff0a0a;
      box-shadow: 0 0 16px rgba(255, 10, 10, 0.2);
    }

    .music-btn.playing {
      border-color: #ff0a0a;
      animation: pulse-music 2s infinite;
    }

    @keyframes pulse-music {
      0%, 100% { box-shadow: 0 0 0 0 rgba(255, 10, 10, 0.2); }
      50% { box-shadow: 0 0 12px 4px rgba(255, 10, 10, 0.15); }
    }

    #ytPlayer {
      position: fixed;
      top: -9999px;
      left: -9999px;
      width: 1px;
      height: 1px;
      pointer-events: none;
    }

    /* ── Playlist Panel ── */
    .playlist-panel {
      position: fixed;
      bottom: 76px;
      right: 20px;
      width: 300px;
      background: #111;
      border: 1px solid #3d1a1a;
      border-radius: 12px;
      z-index: 9998;
      overflow: hidden;
      display: none;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.5);
    }

    .playlist-panel.open {
      display: block;
    }

    .playlist-header {
      padding: 14px 16px;
      border-bottom: 1px solid #3d1a1a;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .playlist-header h4 {
      font-family: 'Rajdhani', sans-serif;
      font-size: 16px;
      color: #ff0a0a;
      letter-spacing: 2px;
      margin: 0;
    }

    .playlist-controls {
      display: flex;
      gap: 8px;
    }

    .pl-ctrl-btn {
      background: none;
      border: 1px solid #3d1a1a;
      color: #df6f6f;
      width: 30px;
      height: 30px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s;
    }

    .pl-ctrl-btn:hover {
      border-color: #ff0a0a;
      color: #ff0a0a;
    }

    .pl-ctrl-btn.active {
      border-color: #ff0a0a;
      background: rgba(255, 10, 10, 0.1);
      color: #ff0a0a;
    }

    .playlist-list {
      max-height: 240px;
      overflow-y: auto;
      padding: 8px 0;
    }

    .playlist-list::-webkit-scrollbar {
      width: 4px;
    }

    .playlist-list::-webkit-scrollbar-track {
      background: transparent;
    }

    .playlist-list::-webkit-scrollbar-thumb {
      background: #3d1a1a;
      border-radius: 2px;
    }

    .pl-track {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 16px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .pl-track:hover {
      background: rgba(255, 10, 10, 0.03);
    }

    .pl-track.active {
      background: rgba(255, 10, 10, 0.06);
    }

    .pl-track-num {
      font-family: 'Rajdhani', sans-serif;
      font-size: 14px;
      color: #333;
      width: 20px;
      text-align: center;
    }

    .pl-track.active .pl-track-num {
      color: #ff0a0a;
    }

    .pl-track-info {
      flex: 1;
      min-width: 0;
    }

    .pl-track-name {
      font-size: 13px;
      color: #ccc;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .pl-track.active .pl-track-name {
      color: #ff0a0a;
    }

    .pl-track-artist {
      font-size: 11px;
      color: #444;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .pl-now-playing {
      padding: 12px 16px;
      border-top: 1px solid #3d1a1a;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .pl-now-label {
      font-size: 10px;
      color: #444;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .pl-now-title {
      font-size: 12px;
      color: #df6f6f;
      flex: 1;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    @media (max-width: 600px) {
      .playlist-panel {
        right: 10px;
        left: 10px;
        width: auto;
        bottom: 72px;
      }
    }

    .site-content {
      display: none;
    }

    .site-content.visible {
      display: block;
    }
  </style>
</head>
<body>

  <!-- Hidden YouTube Player -->
  <div id="ytPlayer"></div>

  <!-- Playlist Panel -->
  <div class="playlist-panel" id="playlistPanel">
    <div class="playlist-header">
      <h4>PLAYLIST</h4>
      <div class="playlist-controls">
        <button class="pl-ctrl-btn" id="prevBtn" onclick="prevTrack()" title="Previous">&#9664;</button>
        <button class="pl-ctrl-btn" id="playPauseBtn" onclick="toggleMusic()" title="Play/Pause">&#9654;</button>
        <button class="pl-ctrl-btn" id="nextBtn" onclick="nextTrack()" title="Next">&#9654;</button>
        <button class="pl-ctrl-btn" id="shuffleBtn" onclick="toggleShuffle()" title="Shuffle">&#8645;</button>
      </div>
    </div>
    <div class="playlist-list" id="playlistList"></div>
    <div class="pl-now-playing">
      <span class="pl-now-label">Now:</span>
      <span class="pl-now-title" id="nowPlayingTitle">Nothing playing</span>
    </div>
  </div>

  <!-- Music Toggle Button -->
  <button class="music-btn" id="musicBtn" onclick="togglePlaylist()" title="Music">&#9835;</button>

  <!-- Discord Login Overlay -->
  <div class="discord-overlay" id="discordOverlay">
    <div class="discord-box">
      <h2>TRAP TOWN</h2>
      <div class="discord-divider"></div>
      <p>Verify with Discord to access the store</p>
      <a id="discordLoginBtn" class="discord-btn">
        <svg viewBox="0 0 24 24"><path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515.074.074 0 0 0-.079.037c-.21.375-.444.864-.608 1.25a18.27 18.27 0 0 0-5.487 0 12.64 12.64 0 0 0-.617-1.25.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057 19.9 19.9 0 0 0 5.993 3.03.078.078 0 0 0 .084-.028 14.09 14.09 0 0 0 1.226-1.994.076.076 0 0 0-.041-.106 13.107 13.107 0 0 1-1.872-.892.077.077 0 0 1-.008-.128 10.2 10.2 0 0 0 .372-.292.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.198.373.292a.077.077 0 0 1-.006.127 12.299 12.299 0 0 1-1.873.892.077.077 0 0 0-.041.107c.36.698.772 1.362 1.225 1.993a.076.076 0 0 0 .084.028 19.839 19.839 0 0 0 6.002-3.03.077.077 0 0 0 .032-.054c.5-5.177-.838-9.674-3.549-13.66a.061.061 0 0 0-.031-.03z"/></svg>
        Login with Discord
      </a>
      <p class="note">We only use Discord to verify your identity</p>
    </div>
  </div>

  <!-- Site Content (hidden until logged in) -->
  <div class="site-content" id="siteContent">

  <!-- User Bar -->
  <div class="user-bar" id="userBar" style="display:none;">
    <img id="userAvatar" src="" alt="avatar">
    <span id="userName"></span>
    <button class="logout-btn" onclick="logout()">Logout</button>
  </div>

  <!-- Top Banner -->
  <header class="top-banner">
    <h1>TRAP TOWN</h1>
    <p>Official Game Store</p>
  </header>

  <!-- Navigation -->
  <nav>
    <a href="#customs" onclick="showSection('store')">Customs</a>
    <a href="#dashboard" onclick="showSection('dashboard')">Dashboard</a>
    <a href="#team" onclick="showSection('team')">Team</a>
    <a href="#turfs" onclick="showSection('turfs')">Turfs</a>
    <a href="#leaderboard" onclick="showSection('leaderboard')">Leaderboard</a>
    <a href="https://www.roblox.com/games/132442651443504/Reflex-PvP-Comeback" target="_blank">Play Now</a>
  </nav>

  <!-- Customs Section -->
  <main>
    <section id="customs">
      <h2 class="section-title">CUSTOMS</h2>
      <p class="section-subtitle">Get your own custom items — pay via PayPal</p>

      <div class="gamepass-grid">

        <!-- CUSTOM SHIRTS -->
        <div class="gamepass-card">
          <span class="badge badge-popular">Popular</span>
          <div class="gamepass-icon" style="font-size:48px;">&#128085;</div>
          <div class="gamepass-name">Custom Shirt</div>
          <div class="gamepass-desc">Get a fully custom designed shirt made just for you. Comes with matching custom pants included!</div>
          <div class="gamepass-price">&pound;20 <span style="font-size:14px;color:#5a5a5a;">GBP</span></div>
          <a href="https://www.paypal.me/TRAPSTUDIOSLTDWORKER/20GBP" class="buy-btn" target="_blank">Buy with PayPal</a>
        </div>

        <!-- CUSTOM GOOSE -->
        <div class="gamepass-card">
          <div class="gamepass-icon" style="font-size:48px;">&#129414;</div>
          <div class="gamepass-name">Custom Goose</div>
          <div class="gamepass-desc">Get your own custom designed goose with unique colours and style.</div>
          <div class="gamepass-price">&pound;15 <span style="font-size:14px;color:#5a5a5a;">GBP</span></div>
          <a href="https://www.paypal.me/TRAPSTUDIOSLTDWORKER/15GBP" class="buy-btn" target="_blank">Buy with PayPal</a>
        </div>

        <!-- CUSTOM BAG -->
        <div class="gamepass-card">
          <div class="gamepass-icon" style="font-size:48px;">&#127890;</div>
          <div class="gamepass-name">Custom Bag</div>
          <div class="gamepass-desc">Rock a one-of-a-kind custom bag to show off your style in-game.</div>
          <div class="gamepass-price">&pound;5 <span style="font-size:14px;color:#5a5a5a;">GBP</span></div>
          <a href="https://www.paypal.me/TRAPSTUDIOSLTDWORKER/5GBP" class="buy-btn" target="_blank">Buy with PayPal</a>
        </div>

        <!-- CUSTOM PANTS -->
        <div class="gamepass-card">
          <span class="badge badge-new">Free with Shirt</span>
          <div class="gamepass-icon" style="font-size:48px;">&#128086;</div>
          <div class="gamepass-name">Custom Pants</div>
          <div class="gamepass-desc">Custom pants are included free when you purchase a custom shirt!</div>
          <div class="gamepass-price">FREE <span style="font-size:14px;color:#5a5a5a;">with shirt</span></div>
          <a href="https://www.paypal.me/TRAPSTUDIOSLTDWORKER/20GBP" class="buy-btn" target="_blank">Buy Shirt + Pants</a>
        </div>

        <!-- CUSTOM CHAIN -->
        <div class="gamepass-card">
          <div class="gamepass-icon" style="font-size:48px;">&#9939;</div>
          <div class="gamepass-name">Custom Chain</div>
          <div class="gamepass-desc">Drip out your character with a custom designed chain to flex on everyone.</div>
          <div class="gamepass-price">&pound;10 <span style="font-size:14px;color:#5a5a5a;">GBP</span></div>
          <a href="https://www.paypal.me/TRAPSTUDIOSLTDWORKER/10GBP" class="buy-btn" target="_blank">Buy with PayPal</a>
        </div>

        <!-- CUSTOM CARS -->
        <div class="gamepass-card">
          <div class="gamepass-icon" style="font-size:48px;">&#128663;</div>
          <div class="gamepass-name">Custom Car</div>
          <div class="gamepass-desc">Get a fully custom designed car with your own colours and decals.</div>
          <div class="gamepass-price">&pound;20 <span style="font-size:14px;color:#5a5a5a;">GBP</span></div>
          <a href="https://www.paypal.me/TRAPSTUDIOSLTDWORKER/20GBP" class="buy-btn" target="_blank">Buy with PayPal</a>
        </div>

      </div>
    </section>
  </main>

  <!-- Dashboard Section -->
  <section id="dashboard" class="dashboard-section" style="display:none;">
    <div class="dash-container">
      <h2 class="section-title">DASHBOARD</h2>
      <p class="section-subtitle">Enter your Roblox username to link your account</p>

      <!-- Roblox Username Lookup -->
      <div class="roblox-lookup" id="robloxLookup">
        <div class="lookup-box">
          <div class="lookup-icon">&#127918;</div>
          <h3 class="lookup-title">Link Your Roblox Account</h3>
          <p class="lookup-desc">Enter your Roblox username to verify ownership — no password needed!</p>
          <div class="lookup-input-wrap">
            <input type="text" id="robloxUsername" class="lookup-input" placeholder="Your Roblox username...">
            <button class="lookup-btn" id="lookupBtn" onclick="lookupRobloxUser()">Verify</button>
          </div>
          <p class="lookup-error" id="lookupError" style="display:none;"></p>
        </div>
      </div>

      <!-- Roblox Profile (shown after lookup) -->
      <div class="roblox-profile" id="robloxProfile" style="display:none;">
        <div class="profile-card">
          <img id="robloxAvatar" class="profile-avatar" src="" alt="avatar">
          <div class="profile-info">
            <div class="profile-name" id="robloxDisplayName"></div>
            <div class="profile-username" id="robloxUserTag"></div>
          </div>
          <button class="unlink-btn" onclick="unlinkRoblox()">Unlink</button>
        </div>
      </div>

      <!-- Owned Gamepasses -->
      <div class="owned-passes" id="ownedPasses" style="display:none;">
        <h3 class="owned-title">YOUR CUSTOMS</h3>
        <div class="owned-grid" id="ownedGrid"></div>
        <p class="no-passes" id="noPasses" style="display:none;">You don't have any customs from Trap Town yet.</p>
      </div>

    </div>
  </section>

  <!-- Team Section -->
  <section id="team" class="team-section" style="display:none;">
    <h2 class="section-title">THE TEAM</h2>
    <p class="section-subtitle">The people behind Trap Town</p>
    <div class="team-grid" id="teamGrid">
      <div class="team-card" id="team-1357419387639955740">
        <div class="team-avatar-wrap">
          <div class="team-avatar-placeholder"></div>
        </div>
        <div class="team-name">Loading...</div>
        <div class="team-tag">Owner</div>
      </div>
      <div class="team-card" id="team-1347286095972532305">
        <div class="team-avatar-wrap">
          <div class="team-avatar-placeholder"></div>
        </div>
        <div class="team-name">Loading...</div>
        <div class="team-tag">Owner</div>
      </div>
    </div>
  </section>

  <!-- Turfs Section -->
  <section id="turfs" class="turfs-section" style="display:none;">
    <h2 class="section-title">TURFS / GANGS</h2>
    <p class="section-subtitle">Claim your territory in Trap Town</p>
    <div class="turfs-grid">

      <div class="turf-card">
        <div class="turf-size">SMALL TURF</div>
        <div class="turf-price">&pound;5 <span>GBP</span></div>
        <div class="turf-desc">Perfect for starting your gang and claiming a small piece of the map.</div>
        <ul class="turf-features">
          <li>Small territory zone</li>
          <li>Basic gang perks</li>
          <li>Gang name tag</li>
        </ul>
        <a href="https://www.paypal.me/TRAPSTUDIOSLTDWORKER/5GBP" class="turf-buy-btn" target="_blank">Buy with PayPal - &pound;5</a>
      </div>

      <div class="turf-card featured">
        <div class="turf-size">MEDIUM TURF</div>
        <div class="turf-price">&pound;10 <span>GBP</span></div>
        <div class="turf-desc">Expand your territory and dominate a larger area of the map.</div>
        <ul class="turf-features">
          <li>Medium territory zone</li>
          <li>Enhanced gang perks</li>
          <li>Gang name tag</li>
          <li>Custom gang colour</li>
        </ul>
        <a href="https://www.paypal.me/TRAPSTUDIOSLTDWORKER/10GBP" class="turf-buy-btn" target="_blank">Buy with PayPal - &pound;10</a>
      </div>

      <div class="turf-card">
        <div class="turf-size">LARGE TURF</div>
        <div class="turf-price">&pound;20 <span>GBP</span></div>
        <div class="turf-desc">Maximum territory for the most powerful gangs on the server.</div>
        <ul class="turf-features">
          <li>Large territory zone</li>
          <li>Premium gang perks</li>
          <li>Gang name tag</li>
          <li>Custom gang colour</li>
          <li>Priority support</li>
        </ul>
        <a href="https://www.paypal.me/TRAPSTUDIOSLTDWORKER/20GBP" class="turf-buy-btn" target="_blank">Buy with PayPal - &pound;20</a>
      </div>

    </div>
  </section>

  <!-- Leaderboard Section -->
  <section id="leaderboard" class="leaderboard-section" style="display:none;">
    <h2 class="section-title">LEADERBOARD</h2>
    <p class="section-subtitle">Most active visitors</p>
    <table class="leaderboard-table">
      <tbody id="leaderboardBody">
        <tr><td colspan="3" class="lb-empty">Loading leaderboard...</td></tr>
      </tbody>
    </table>
  </section>

  <!-- Footer -->
  <footer>
    <p>&copy; 2026 TRAP TOWN &mdash; Not affiliated with Roblox Corporation.</p>
    <p style="margin-top: 8px;">
      <a href="https://www.roblox.com/" target="_blank">Roblox.com</a>
    </p>
  </footer>

  </div><!-- end site-content -->

  <script>
    const CLIENT_ID = '1470840282760085515';
    const REDIRECT_URI = window.location.origin + window.location.pathname;
    const DISCORD_AUTH_URL = `https://discord.com/oauth2/authorize?client_id=${CLIENT_ID}&response_type=token&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=identify`;

    const overlay = document.getElementById('discordOverlay');
    const siteContent = document.getElementById('siteContent');
    const loginBtn = document.getElementById('discordLoginBtn');
    const userBar = document.getElementById('userBar');
    const userAvatar = document.getElementById('userAvatar');
    const userName = document.getElementById('userName');

    loginBtn.href = DISCORD_AUTH_URL;

    // Check if returning from Discord OAuth
    function getTokenFromHash() {
      const hash = window.location.hash.substring(1);
      const params = new URLSearchParams(hash);
      return params.get('access_token');
    }

    // Fetch Discord user info
    async function fetchUser(token) {
      const res = await fetch('https://discord.com/api/users/@me', {
        headers: { Authorization: `Bearer ${token}` }
      });
      if (!res.ok) throw new Error('Failed to fetch user');
      return res.json();
    }

    // Show the site
    function showSite(user) {
      overlay.classList.add('hidden');
      siteContent.classList.add('visible');
      if (user) {
        const avatarURL = user.avatar
          ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=64`
          : `https://cdn.discordapp.com/embed/avatars/${parseInt(user.discriminator || '0') % 5}.png`;
        userAvatar.src = avatarURL;
        userName.textContent = user.global_name || user.username;
        userBar.style.display = 'flex';
        // Track visit in Firebase
        if (typeof trackVisit === 'function') trackVisit(user);
      }
    }

    // Logout
    function logout() {
      localStorage.removeItem('discord_token');
      localStorage.removeItem('discord_user');
      window.location.hash = '';
      window.location.reload();
    }

    // ── Dashboard / Roblox Lookup ──
    const GAME_PASSES = [
      { id: 1709189399, name: 'Custom Name', icon: '', img: 'https://tr.rbxcdn.com/180DAY-2cd7f246a3a03278f469a272a979a003/150/150/Image/Png/noFilter' },
      { id: 1710604454, name: 'Custom Avatar', icon: '', img: 'https://tr.rbxcdn.com/180DAY-98dd7b9d036c3b30cf22edde314a3302/150/150/Image/Png/noFilter' }
    ];

    // CORS proxy for Roblox APIs
    function robloxFetch(url) {
      return fetch('https://api.allorigins.win/get?url=' + encodeURIComponent(url))
        .then(r => r.json())
        .then(d => JSON.parse(d.contents));
    }

    // ── Team / Owners ──
    const TEAM_MEMBERS = [
      { discordId: '1357419387639955740', role: 'Owner', displayName: 'RM/E1', username: 'reaalrm', avatar: 'https://cdn.discordapp.com/avatars/1357419387639955740/18d1bb8b91d989ddc28ca82014648ec0.png?size=256' },
      { discordId: '1347286095972532305', role: 'Owner', displayName: 'Msav!', username: 'skzold566', avatar: 'https://cdn.discordapp.com/avatars/1347286095972532305/5de6c2657b695c06910b2be8e174c4c4.png?size=256' }
    ];

    let teamLoaded = false;

    function loadTeam() {
      if (teamLoaded) return;
      teamLoaded = true;

      for (const member of TEAM_MEMBERS) {
        const card = document.getElementById(`team-${member.discordId}`);
        card.querySelector('.team-avatar-wrap').innerHTML = `<img src="${member.avatar}" alt="avatar">`;
        card.querySelector('.team-name').textContent = member.displayName;
        card.querySelector('.team-tag').textContent = member.role;

        const usernameEl = document.createElement('div');
        usernameEl.className = 'team-username';
        usernameEl.textContent = '@' + member.username;
        card.querySelector('.team-name').after(usernameEl);
      }
    }

    function showSection(section) {
      const store = document.querySelector('main');
      const dash = document.getElementById('dashboard');
      const team = document.getElementById('team');
      const turfs = document.getElementById('turfs');
      const lb = document.getElementById('leaderboard');
      store.style.display = 'none';
      dash.style.display = 'none';
      team.style.display = 'none';
      turfs.style.display = 'none';
      lb.style.display = 'none';
      if (section === 'store') {
        store.style.display = 'block';
      } else if (section === 'dashboard') {
        dash.style.display = 'block';
        const savedRoblox = localStorage.getItem('roblox_user');
        if (savedRoblox) {
          const user = JSON.parse(savedRoblox);
          showRobloxProfile(user);
          checkGamepasses(user.id);
        }
      } else if (section === 'team') {
        team.style.display = 'block';
        loadTeam();
      } else if (section === 'turfs') {
        turfs.style.display = 'block';
      } else if (section === 'leaderboard') {
        lb.style.display = 'block';
        loadLeaderboard();
      }
    }

    async function lookupRobloxUser() {
      const input = document.getElementById('robloxUsername');
      const error = document.getElementById('lookupError');
      const btn = document.getElementById('lookupBtn');
      const username = input.value.trim();

      error.style.display = 'none';
      if (!username) {
        error.textContent = 'Please enter a Roblox username.';
        error.style.display = 'block';
        return;
      }

      btn.disabled = true;
      btn.textContent = 'Verifying...';

      try {
        // Look up user by username via search
        const data = await robloxFetch(`https://users.roblox.com/v1/users/search?keyword=${encodeURIComponent(username)}&limit=10`);

        if (!data.data || data.data.length === 0) {
          error.textContent = 'User not found. Check the spelling and try again.';
          error.style.display = 'block';
          btn.disabled = false;
          btn.textContent = 'Verify';
          return;
        }

        // Find exact match
        const user = data.data.find(u => u.name.toLowerCase() === username.toLowerCase()) || data.data[0];

        // Get avatar thumbnail
        const avatarData = await robloxFetch(`https://thumbnails.roblox.com/v1/users/avatar-headshot?userIds=${user.id}&size=150x150&format=Png&isCircular=true`);
        user.avatarUrl = avatarData.data?.[0]?.imageUrl || '';

        localStorage.setItem('roblox_user', JSON.stringify(user));
        showRobloxProfile(user);
        checkGamepasses(user.id);

      } catch (e) {
        error.textContent = 'Something went wrong. Please try again.';
        error.style.display = 'block';
      }

      btn.disabled = false;
      btn.textContent = 'Verify';
    }

    function showRobloxProfile(user) {
      document.getElementById('robloxLookup').style.display = 'none';
      document.getElementById('robloxProfile').style.display = 'block';
      document.getElementById('robloxAvatar').src = user.avatarUrl || '';
      document.getElementById('robloxDisplayName').textContent = user.displayName || user.name;
      document.getElementById('robloxUserTag').textContent = '@' + user.name;
    }

    async function checkGamepasses(userId) {
      const ownedGrid = document.getElementById('ownedGrid');
      const ownedPasses = document.getElementById('ownedPasses');
      const noPasses = document.getElementById('noPasses');

      ownedGrid.innerHTML = '';
      ownedPasses.style.display = 'block';

      let ownedCount = 0;

      for (const pass of GAME_PASSES) {
        let isOwned = false;
        try {
          const data = await robloxFetch(`https://inventory.roblox.com/v1/users/${userId}/items/GamePass/${pass.id}`);
          isOwned = data.data && data.data.length > 0;
        } catch (e) {
          isOwned = false;
        }

        if (isOwned) ownedCount++;

        const item = document.createElement('div');
        item.className = 'owned-item ' + (isOwned ? 'owned' : 'not-owned');
        item.innerHTML = `
          <div class="owned-item-icon">${pass.img ? `<img src="${pass.img}" alt="${pass.name}" style="width:40px;height:40px;border-radius:8px;">` : pass.icon}</div>
          <div class="owned-item-info">
            <div class="owned-item-name">${pass.name}</div>
            <div class="owned-item-status ${isOwned ? 'status-owned' : 'status-not-owned'}">
              ${isOwned ? 'Owned' : 'Not Owned'}
            </div>
          </div>
        `;
        ownedGrid.appendChild(item);
      }

      noPasses.style.display = ownedCount === 0 ? 'block' : 'none';
    }

    function unlinkRoblox() {
      localStorage.removeItem('roblox_user');
      document.getElementById('robloxLookup').style.display = 'block';
      document.getElementById('robloxProfile').style.display = 'none';
      document.getElementById('ownedPasses').style.display = 'none';
      document.getElementById('robloxUsername').value = '';
    }

    // Allow pressing Enter in the username input
    document.getElementById('robloxUsername')?.addEventListener('keydown', function(e) {
      if (e.key === 'Enter') lookupRobloxUser();
    });

    // Init
    (async function init() {
      // Check for token in URL hash (returning from Discord)
      const hashToken = getTokenFromHash();
      if (hashToken) {
        try {
          const user = await fetchUser(hashToken);
          localStorage.setItem('discord_token', hashToken);
          localStorage.setItem('discord_user', JSON.stringify(user));
          window.location.hash = '';
          showSite(user);
          return;
        } catch (e) {
          localStorage.removeItem('discord_token');
          localStorage.removeItem('discord_user');
        }
      }

      // Check for saved session
      const savedToken = localStorage.getItem('discord_token');
      const savedUser = localStorage.getItem('discord_user');
      if (savedToken && savedUser) {
        try {
          const user = await fetchUser(savedToken);
          localStorage.setItem('discord_user', JSON.stringify(user));
          showSite(user);
          return;
        } catch (e) {
          localStorage.removeItem('discord_token');
          localStorage.removeItem('discord_user');
        }
      }

      // Not logged in — show overlay
      overlay.classList.remove('hidden');
    })();
  </script>

  <!-- YouTube IFrame API -->
  <script>
    // ── Playlist ──
    const PLAYLIST = [
      { id: '_isAv1xBX_0', title: 'Song 1', artist: 'Playlist' },
      { id: 'ipM9SkIkwCY', title: 'Song 2', artist: 'Playlist' },
      { id: 'idp20v_PTYo', title: 'Song 3', artist: 'Playlist' }
    ];

    let ytPlayer = null;
    let musicPlaying = false;
    let currentTrack = 0;
    let shuffleOn = false;
    const musicBtn = document.getElementById('musicBtn');
    const playlistPanel = document.getElementById('playlistPanel');
    const playlistList = document.getElementById('playlistList');
    const nowPlayingTitle = document.getElementById('nowPlayingTitle');
    const playPauseBtn = document.getElementById('playPauseBtn');

    // Build playlist UI
    function renderPlaylist() {
      playlistList.innerHTML = '';
      PLAYLIST.forEach((track, i) => {
        const el = document.createElement('div');
        el.className = 'pl-track' + (i === currentTrack ? ' active' : '');
        el.onclick = () => playTrack(i);
        el.innerHTML = `
          <div class="pl-track-num">${i === currentTrack && musicPlaying ? '&#9654;' : (i + 1)}</div>
          <div class="pl-track-info">
            <div class="pl-track-name">${track.title}</div>
            <div class="pl-track-artist">${track.artist}</div>
          </div>
        `;
        playlistList.appendChild(el);
      });
    }

    function updateNowPlaying() {
      const track = PLAYLIST[currentTrack];
      nowPlayingTitle.textContent = track ? track.title + ' - ' + track.artist : 'Nothing playing';
    }

    // Toggle playlist panel
    function togglePlaylist() {
      playlistPanel.classList.toggle('open');
    }

    // Load YouTube IFrame API
    const tag = document.createElement('script');
    tag.src = 'https://www.youtube.com/iframe_api';
    document.head.appendChild(tag);

    function onYouTubeIframeAPIReady() {
      ytPlayer = new YT.Player('ytPlayer', {
        videoId: PLAYLIST[0].id,
        playerVars: { autoplay: 0 },
        events: {
          onReady: function(e) {
            e.target.setVolume(50);
            renderPlaylist();
            updateNowPlaying();
            // Try to fetch real titles from YouTube
            fetchTrackTitles();
          },
          onStateChange: function(e) {
            if (e.data === YT.PlayerState.ENDED) {
              nextTrack();
            }
          }
        }
      });
    }

    function playTrack(index) {
      if (!ytPlayer) return;
      currentTrack = index;
      ytPlayer.loadVideoById(PLAYLIST[currentTrack].id);
      musicPlaying = true;
      musicBtn.classList.add('playing');
      playPauseBtn.innerHTML = '&#9646;&#9646;';
      renderPlaylist();
      updateNowPlaying();
    }

    function toggleMusic() {
      if (!ytPlayer) return;
      if (musicPlaying) {
        ytPlayer.pauseVideo();
        musicPlaying = false;
        musicBtn.classList.remove('playing');
        playPauseBtn.innerHTML = '&#9654;';
      } else {
        ytPlayer.playVideo();
        musicPlaying = true;
        musicBtn.classList.add('playing');
        playPauseBtn.innerHTML = '&#9646;&#9646;';
      }
      renderPlaylist();
    }

    function nextTrack() {
      if (shuffleOn) {
        let next;
        do { next = Math.floor(Math.random() * PLAYLIST.length); } while (next === currentTrack && PLAYLIST.length > 1);
        playTrack(next);
      } else {
        playTrack((currentTrack + 1) % PLAYLIST.length);
      }
    }

    function prevTrack() {
      playTrack((currentTrack - 1 + PLAYLIST.length) % PLAYLIST.length);
    }

    function toggleShuffle() {
      shuffleOn = !shuffleOn;
      document.getElementById('shuffleBtn').classList.toggle('active', shuffleOn);
    }

    // Fetch real video titles from YouTube oEmbed
    async function fetchTrackTitles() {
      for (let i = 0; i < PLAYLIST.length; i++) {
        try {
          const res = await fetch(`https://noembed.com/embed?url=https://www.youtube.com/watch?v=${PLAYLIST[i].id}`);
          const data = await res.json();
          if (data.title) {
            const parts = data.title.split(' - ');
            PLAYLIST[i].title = parts.length > 1 ? parts[1].trim() : data.title;
            PLAYLIST[i].artist = parts.length > 1 ? parts[0].trim() : 'Unknown';
          }
        } catch (e) {}
      }
      renderPlaylist();
      updateNowPlaying();
    }
  </script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCa844jPRTXBJj5xd6k6dxO9KMfF-AG9xI",
      authDomain: "reflexpvp-605a4.firebaseapp.com",
      databaseURL: "https://reflexpvp-605a4-default-rtdb.firebaseio.com",
      projectId: "reflexpvp-605a4",
      storageBucket: "reflexpvp-605a4.firebasestorage.app",
      messagingSenderId: "1098833666715",
      appId: "1:1098833666715:web:36e9cf32bf48bea35b1c3e"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    // Track visit when user logs in with Discord
    function trackVisit(user) {
      if (!user || !user.id) return;
      const userRef = db.ref('visits/' + user.id);
      userRef.once('value').then(snapshot => {
        const data = snapshot.val();
        const avatarURL = user.avatar
          ? `https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png?size=64`
          : `https://cdn.discordapp.com/embed/avatars/${parseInt(user.discriminator || '0') % 5}.png`;
        userRef.set({
          displayName: user.global_name || user.username,
          username: user.username,
          avatar: avatarURL,
          visits: (data?.visits || 0) + 1,
          lastVisit: Date.now()
        });
      }).catch(err => console.error('Track visit error:', err));
    }

    // Load leaderboard
    function loadLeaderboard() {
      const tbody = document.getElementById('leaderboardBody');
      db.ref('visits').orderByChild('visits').limitToLast(20).once('value').then(snapshot => {
        const entries = [];
        snapshot.forEach(child => {
          entries.push(child.val());
        });
        entries.sort((a, b) => b.visits - a.visits);

        if (entries.length === 0) {
          tbody.innerHTML = '<tr><td colspan="3" class="lb-empty">No visitors yet. Be the first!</td></tr>';
          return;
        }

        tbody.innerHTML = entries.map((entry, i) => `
          <tr class="leaderboard-row">
            <td><span class="lb-rank ${i < 3 ? 'lb-rank-' + (i+1) : ''}">#${i + 1}</span></td>
            <td>
              <div class="lb-user">
                <img class="lb-avatar" src="${entry.avatar}" alt="avatar">
                <div>
                  <div class="lb-name">${entry.displayName}</div>
                  <div class="lb-username">@${entry.username}</div>
                </div>
              </div>
            </td>
            <td class="lb-visits">${entry.visits} <span>visits</span></td>
          </tr>
        `).join('');
      }).catch(err => {
        console.error('Leaderboard error:', err);
        tbody.innerHTML = '<tr><td colspan="3" class="lb-empty">Failed to load leaderboard.</td></tr>';
      });
    }
  </script>

</body>
</html>
